<!DOCTYPE html>
<html lang="en">
<head>
    <title>System Status</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pivotal Energy Solution">
    <meta name="author" content="Pivotal Energy Solutions">
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/images/favicon.ico"
          type="image/x-icon">
    <link rel="apple-touch-icon"
          href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/images/apple-touch-icon.png">
    <link href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/css/bootstrap/3.3.2/bootstrap.min.css?v=1"
          rel="stylesheet" media="screen">
    <link href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/css/font-awesome/4.4.0/font-awesome.min.css?v=1"
          rel="stylesheet" media="screen">
    <link href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/css/main.min.css?v=1" rel="stylesheet"
          media="screen">
    <link href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/css/bootstrap_datatables.min.css?v=1"
          rel="stylesheet" media="screen">
    <link href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/css/all.min.css" type="text/css"
          media="screen" rel="stylesheet"/>
    <link href="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/css/select2_modifications.min.css?v=1"
          rel="stylesheet" media="screen">
    <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.2.min.js"></script>

    <!-- Google Analytics -->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-26647319-1']);
        _gaq.push(['_setDomainName', 'axis.pivotalenergy.net']);
        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="brand navbar-brand" href="/" id="brand">&nbsp;</a>
        <div class="navbar-collapse collapse navbar-responsive-collapse nav-collapse-scrollable">
            <ul class="nav navbar-nav">
                <li class=" "><a href="/"> Home</a></li>
                <li class=" "><a href="http://support.pivotalenergysolutions.com/login" target="_blank"> Support</a></li>
            </ul>
            <div class="pull-right"></div>
        </div>
    </div>
</div>
<div id="content" class="container">
    <div id="message_area"></div>
    <div class="row" style="min-height: 300px">
        <div class="col-md-12">
            <header>
                <div class="row row-header col-md-12">
                    <p><span id="deployment-name"></span> System Status</p>
                </div>
            </header>
            <div class="col-md-7">
                <br />
                <div class="progress">
                    <div id="system-progress" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0"
                         aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                        <span class="sr-only"><span class="pct_running">0</span>% Complete</span>
                    </div>
                </div>

                <div id="status">
                    <h4>System appears to be <span class="pct_running">0</span>% functional.</h4>
                    <ul>
                        <li>Hostname: <span id="hostname">hostname</span></li>
                        <li>Public Hostname: <span id="public_hostname">public_hostname</span></li>
                        <li>Public IP: <span id="public_ipv4">public_ipv4</span></li>
                        <li>Instance ID: <a target="_blank" id="instance_id" href=""></a></li>
                        <li>AMI ID: <a target="_blank" id="ami_id" href=""></a></li>
                        <li>Uptime: <span id="uptime">uptime</span></li>
                    </ul>

                    <ul>
                        <li>System Time: <span id="system_time">system_time</span></li>
                        <li>Local Time: <span id="local_time">local_time</span></li>
                    </ul>

                    <br><h4>Deployment Details</h4>
                    <ul>
                        <li>GitHub Change: <a target="_blank" id="git_sha" href=""></a></li>
                        <li>GitHub Branch: <span class="git_branch">git_branch</span></li>
                        <li>GitHub Release Date: <span id="git_update">git_update</span></li>
                        <li>Base Version: <span id="git_version">git_version</span></li>
                        <li>Owner: <span id="git_author">git_author</span></li>
                        <br>
                        <li>Deployment ID: <a target="_blank" id="deployment_id" href=""></a></li>
                        <li>Deployment Instance <a target="_blank" id="deployment_events" href=""></a></li>
                        <li>Deployment Date: <span id="deployment_date">deployment_date</span></li>
                        <li>Deployment Status: <span id="deployment_status">deployment_status</span></li>
                        <br>
                        <li>Compare to Master: <a target="_blank" id="compare_to_master" href=""></a></li>
                        <li>Compare to <span class="git_branch">git_branch</span>: <a target="_blank" id="compare_to_branch" href=""></a></li>
                    </ul>
                </div>
                <br>


            </div>
            <div class="col-md-1">&nbsp;</div>
            <div class="col-md-4" class="well" style="padding-top: 8px;min-height: 300px">
                <h4>System Services</h4>
                <div id="system_stats"></div>
            </div>
        </div>

    </div>
    <hr/>
    <div class="row">
        <div class="col-md-12">
            <div id="logs"></div>
        </div>
    </div>

    <hr/>
    <footer>
        <div class="row">
            <div class="col-md-3"></div>
            <div class="col-md-9">
                <p class="text-muted text-right" style="font-size: x-small">
                    Copyright Â© 2011-2019 Pivotal Energy Solutions. All Rights Reserved.
                </p>
            </div>
        </div>
    </footer>
    <script src="//s3.amazonaws.com/assets.pivotalenergy.net/static/production/js/vendor/bootstrap/3.3.2/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            url = "/status/"
            $.getJSON(url, function (data) {

                $('#deployment-name').html(data.deployment.deployment_group_pretty)

                var progress_class = 'progress-bar';
                if (!data.status.is_stable) {
                    progress_class = 'progress-bar progress-bar-striped active'
                }
                if (data.status.has_errors){
                    progress_class += ' progress-bar-danger'
                } else if (data.status.has_warnings) {
                    progress_class += ' progress-bar-warning'
                } else {
                    progress_class += ' progress-bar-success'
                }

                $("#system-progress").removeClass().addClass(progress_class)

                $('.pct_running').html(data.status.pct_running)
                $('#system-progress').attr('aria-valuenow', data.status.pct_running)
                $('#system-progress').css('width', data.status.pct_running + "%")

                $('#hostname').html(data.system.hostname)
                $('#public_hostname').html(data.system.public_hostname)
                $('#public_ipv4').html(data.system.public_ipv4)
                $('#instance_id').attr('href', data.system.instance_url)
                $('#instance_id').html(data.system.instance_id)
                $('#ami_id').attr('href', data.system.ami_url)
                $('#ami_id').html(data.system.ami_id)
                $('#uptime').html(data.system.uptime)

                $('#system_time').html(data.system.system_time)
                $('#local_time').html(data.system.local_time)

                if (data.hasOwnProperty('version_info') && data.version_info.hasOwnProperty('base')) {
                    $('#git_sha').attr('href', data.version_info.base.commit_url)
                    $('#git_sha').html(data.version_info.base.sha)
                    $('.git_branch').html(data.version_info.base.branch)
                    $('#git_update').html(data.version_info.base.last_update)
                    $('#git_version').html(data.version_info.base.version)
                    $('#git_author').html(data.version_info.base.author)

                    $('#compare_to_master').attr('href', data.version_info.base.compare_to_master)
                    $('#compare_to_master').html("Compare")
                    $('#compare_to_branch').attr('href', data.version_info.base.compare_to_branch)
                    $('#compare_to_branch').html("Compare")
                }
                if (!data.deployment.hasOwnProperty('error')) {
                    $('#deployment_id').attr('href', data.deployment.deployment_url)
                    $('#deployment_id').html(data.deployment.deployment_id)
                    $('#deployment_events').attr('href', data.deployment.deployment_events_url)
                    $('#deployment_events').html("Events")

                    $('#deployment_date').html(data.deployment.timestamp)
                    $('#deployment_status').html(data.deployment.message)
                }

                $('#system_stats').html('')
                status = '<ul class="list-group">'

                logs='<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">'
                var data_length = data.services.length;
                for (var idx = 0; idx < data_length; idx++) {
                    item = data.services[idx]
                    if (item.sub_state == 'running') {
                        status += '<li class="list-group-item list-group-item-success">'
                    } else {
                        if (item.sub_state == 'restarting') {
                            status += '<li class="list-group-item list-group-item-warning">'
                        } else {
                            status += '<li class="list-group-item list-group-item-danger">'
                        }
                    }
                    status += '<strong>' + item.description +  '</strong><span class="pull-right">' + ' (' + item.process_id + ')' + '</span><ul>'
                    status += '<li>Uptime: ' + item.uptime  + '</li>'
                    status += '<li>Status: ' + item.load_state + ' ' + item.active_state + ' ' + item.sub_state  + '</li>'
                    status += "</ul></li>"

                    logs += '<div class="panel panel-default">'
                    logs += '<div class="panel-heading" role="tab" id="heading' + item.name + '">'
                    logs += '<h4 class="panel-title">'
                    logs += '<a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse' + item.name + '" aria-expanded="false" aria-controls="collapse' + item.name + '">'
                    logs += item.description + '</a></h4></div>'
                    logs += '<div id="collapse' + item.name + '" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading' + item.name + '">'
                    logs += '<div class="panel-body">'
                    for (var lidx=0; lidx < item.logs.length; lidx++){
                        log = item.logs[lidx]
                        logs += '<strong>' + log.name + '</strong> <pre>'
                        for (var jidx=0; jidx < log.log.length; jidx++){
                            logs += log.log[jidx] + '\n';
                        }
                        logs += '</pre>'

                    }
                    logs += '</div></div></div>'

                }
                status += '</ul>'
                $('#system_stats').html(status)

                logs += '</div>'
                $('#logs').html(logs)

            });


        })
    </script>

</div>
</body>
</html>
